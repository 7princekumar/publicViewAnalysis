<!DOCTYPE HTML>
<html>
	<h1>Show page.</h1>
	<head>
		<script src="https://js.pusher.com/4.1/pusher.min.js"></script>
		<script>
		window.onload = function () {
		var chart = new CanvasJS.Chart("chartContainer", {
			exportEnabled: true,
			animationEnabled: true,
			title:{
				text: "Public View Analysis: "
			},
			legend:{
				cursor: "pointer",
				itemclick: explodePie
			},
			data: [{
				type: "pie",
				showInLegend: true,
				toolTipContent: "{name}: <strong>{y}%</strong>",
				indexLabel: "{name} - {y}%",
				dataPoints: [
					{ y: <%= (scoreData.positiveTweetCount * 100)/scoreData.maxTweets %>, name: "Positive", exploded: true },
					{ y: <%= (scoreData.negativeTweetCount * 100)/scoreData.maxTweets %>, name: "Negative" },
					{ y: <%= (scoreData.neutralCount * 100)/scoreData.maxTweets %>, 	  name: "Neutral" },
				]
			}]
		});
		chart.render();
		}
		
		function explodePie (e) {
			if(typeof (e.dataSeries.dataPoints[e.dataPointIndex].exploded) === "undefined" || !e.dataSeries.dataPoints[e.dataPointIndex].exploded) {
				e.dataSeries.dataPoints[e.dataPointIndex].exploded = true;
			} else {
				e.dataSeries.dataPoints[e.dataPointIndex].exploded = false;
			}
			e.chart.render();
		
		}
		</script>
		
		
		
	  
	  
	  
	</head>
	<body>
		<div id="chartContainer" style="height: 300px; width: 100%;"></div>
		
		<p>Total Score: <%=scoreData.totalScore%></p>
		<p>Positive Score: <%=scoreData.positiveScore%></p>
		<p>Negative Score: <%=scoreData.negativeScore%></p>
		
		<!--SHOW WIKI TEXT-->
		<p><%=scoreData.wikiText%></p>
		<hr>
		<!--SHOW TWEETS-->
		<% for(var i=0; i<scoreData.tweetsArray.length; i++){ %>
			<hr>
			<p>Tweet[<%=i%>]: <%=scoreData.tweetsArray[i].text%></p>
		<% } %>
		
		<div id="streamTweetsDiv">
				<!--streamed tweets will be displayed here-->
		</div>
		
		
		<a href="/">Go to Home Page.</a>
		
		
		
		<!--<script src="https://js.pusher.com/4.2/pusher.min.js"></script>-->
		<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
		
		
		<script>
	    // Enable pusher logging - don't include this in production
	    Pusher.logToConsole = true;
	    var pusher = new Pusher('b32865fd7b263aa0ec0f', {
	      cluster: 'ap2',
	      encrypted: true
	    });
	
	    var channel = pusher.subscribe('my-channel');
	    channel.bind('my-event', function(data) {
	      // alert(data.tweet.text);
	      var div = document.getElementById("streamTweetsDiv");
				div.innerHTML += '<p>'+data.tweet.text+'</p>';
	    });
	  </script>
		
	</body>
</html>